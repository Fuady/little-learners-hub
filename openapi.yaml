openapi: 3.0.3
info:
  title: KidLearn Education Platform API
  description: |
    API for the KidLearn education platform. This platform provides educational materials
    for children from Kindergarten to Grade 5, including worksheets, activity books,
    drawing pages, puzzles, and interactive games.
    
    ## Features
    - **Authentication**: Parents and educators can register and login
    - **Materials**: Browse, search, and filter educational materials
    - **Submissions**: Educators can submit new materials
    - **Interactions**: Download, print, and like materials
  version: 1.0.0
  contact:
    name: KidLearn Support
    email: support@kidlearn.example.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000/api/v1
    description: Local development server
  - url: https://api.kidlearn.example.com/v1
    description: Production server

tags:
  - name: Authentication
    description: User authentication and registration
  - name: Users
    description: User management endpoints
  - name: Materials
    description: Educational materials management
  - name: Stats
    description: Platform statistics

paths:
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new parent or educator account
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Invalid request or email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Authenticate a user and return access token
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Invalidate the current user session
      operationId: logoutUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true

  /users/me:
    get:
      tags:
        - Users
      summary: Get current user
      description: Get the currently authenticated user's profile
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /materials:
    get:
      tags:
        - Materials
      summary: List materials
      description: Get a list of all materials with optional filters
      operationId: listMaterials
      parameters:
        - name: type
          in: query
          description: Filter by material type
          schema:
            $ref: '#/components/schemas/MaterialType'
        - name: gradeLevel
          in: query
          description: Filter by grade level
          schema:
            $ref: '#/components/schemas/GradeLevel'
        - name: search
          in: query
          description: Search in title, description, and tags
          schema:
            type: string
        - name: limit
          in: query
          description: Maximum number of results
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
        - name: offset
          in: query
          description: Number of results to skip
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: List of materials
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Material'
                  total:
                    type: integer
                    description: Total number of materials matching the filters
                    example: 42

    post:
      tags:
        - Materials
      summary: Submit new material
      description: Submit a new educational material (educators only)
      operationId: createMaterial
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/CreateMaterialRequest'
      responses:
        '201':
          description: Material created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Material'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Only educators can submit materials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /materials/{id}:
    get:
      tags:
        - Materials
      summary: Get material by ID
      description: Get detailed information about a specific material
      operationId: getMaterialById
      parameters:
        - name: id
          in: path
          required: true
          description: Material ID
          schema:
            type: string
      responses:
        '200':
          description: Material details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Material'
        '404':
          description: Material not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /materials/{id}/download:
    post:
      tags:
        - Materials
      summary: Download material
      description: Get the download URL for a material and increment download count
      operationId: downloadMaterial
      parameters:
        - name: id
          in: path
          required: true
          description: Material ID
          schema:
            type: string
      responses:
        '200':
          description: Download URL
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    format: uri
                    description: Temporary download URL
                    example: https://cdn.kidlearn.example.com/materials/abc-tracing.pdf?token=xyz
        '404':
          description: Material not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /materials/{id}/like:
    post:
      tags:
        - Materials
      summary: Like material
      description: Add a like to a material
      operationId: likeMaterial
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Material ID
          schema:
            type: string
      responses:
        '200':
          description: Like added
          content:
            application/json:
              schema:
                type: object
                properties:
                  likes:
                    type: integer
                    description: Updated like count
                    example: 157
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Material not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /stats:
    get:
      tags:
        - Stats
      summary: Get platform statistics
      description: Get overall statistics about the platform
      operationId: getStats
      responses:
        '200':
          description: Platform statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Stats'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    UserRole:
      type: string
      enum:
        - parent
        - educator
      description: Type of user account

    MaterialType:
      type: string
      enum:
        - worksheet
        - activity_book
        - drawing
        - puzzle
        - game
      description: Type of educational material

    GradeLevel:
      type: string
      enum:
        - kindergarten
        - grade1
        - grade2
        - grade3
        - grade4
        - grade5
      description: Target grade level for the material

    User:
      type: object
      required:
        - id
        - email
        - name
        - role
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        email:
          type: string
          format: email
          example: "parent@example.com"
        name:
          type: string
          example: "Sarah Johnson"
        role:
          $ref: '#/components/schemas/UserRole'
        avatar:
          type: string
          description: Emoji or URL for user avatar
          example: "üë©‚Äçüëß"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T00:00:00Z"

    Material:
      type: object
      required:
        - id
        - title
        - description
        - type
        - gradeLevel
        - thumbnail
        - isInteractive
        - authorId
        - authorName
        - createdAt
        - downloads
        - likes
        - tags
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440001"
        title:
          type: string
          example: "ABC Tracing Fun"
        description:
          type: string
          example: "Learn to trace letters A-Z with colorful guides and fun characters!"
        type:
          $ref: '#/components/schemas/MaterialType'
        gradeLevel:
          $ref: '#/components/schemas/GradeLevel'
        thumbnail:
          type: string
          description: Emoji or image URL for thumbnail
          example: "üìù"
        downloadUrl:
          type: string
          format: uri
          description: URL for downloadable materials (null for interactive-only)
          example: "/materials/abc-tracing.pdf"
        isInteractive:
          type: boolean
          description: Whether this material has an interactive component
          example: false
        authorId:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440002"
        authorName:
          type: string
          example: "Mr. Thompson"
        createdAt:
          type: string
          format: date-time
          example: "2024-06-01T00:00:00Z"
        downloads:
          type: integer
          minimum: 0
          example: 1250
        likes:
          type: integer
          minimum: 0
          example: 89
        tags:
          type: array
          items:
            type: string
          example: ["alphabet", "writing", "tracing"]

    RegisterRequest:
      type: object
      required:
        - email
        - password
        - name
        - role
      properties:
        email:
          type: string
          format: email
          example: "newuser@example.com"
        password:
          type: string
          format: password
          minLength: 8
          example: "securepassword123"
        name:
          type: string
          minLength: 2
          example: "John Doe"
        role:
          $ref: '#/components/schemas/UserRole'

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "parent@example.com"
        password:
          type: string
          format: password
          example: "password123"

    AuthResponse:
      type: object
      required:
        - user
        - accessToken
      properties:
        user:
          $ref: '#/components/schemas/User'
        accessToken:
          type: string
          description: JWT access token
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refreshToken:
          type: string
          description: JWT refresh token
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    CreateMaterialRequest:
      type: object
      required:
        - title
        - description
        - type
        - gradeLevel
        - isInteractive
        - tags
      properties:
        title:
          type: string
          minLength: 3
          maxLength: 100
          example: "Math Addition Worksheet"
        description:
          type: string
          minLength: 10
          maxLength: 500
          example: "Practice addition with fun problems!"
        type:
          $ref: '#/components/schemas/MaterialType'
        gradeLevel:
          $ref: '#/components/schemas/GradeLevel'
        isInteractive:
          type: boolean
          example: false
        tags:
          type: array
          items:
            type: string
          example: ["math", "addition"]
        file:
          type: string
          format: binary
          description: The material file (PDF, image, etc.)

    Stats:
      type: object
      required:
        - totalMaterials
        - totalDownloads
        - totalUsers
        - gradeBreakdown
      properties:
        totalMaterials:
          type: integer
          example: 150
        totalDownloads:
          type: integer
          example: 25000
        totalUsers:
          type: integer
          example: 1200
        gradeBreakdown:
          type: object
          additionalProperties:
            type: integer
          example:
            kindergarten: 30
            grade1: 25
            grade2: 28
            grade3: 22
            grade4: 25
            grade5: 20

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code
          example: "VALIDATION_ERROR"
        message:
          type: string
          description: Human-readable error message
          example: "Invalid email format"
        details:
          type: object
          additionalProperties: true
          description: Additional error details
